# 7.9笔记

## A0_sw 滑动窗口

### 目的

确定不同训练集大小是否会对训练效果产生显著影响。

### 方法

用window size来控制训练数据的最大长度

### 结果

等权情况下
![AO_sw_1](../img/A0_sw_1.jpg)

| ew(window size) | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| --------------- | --------- | --------- | --------- | --------- | --------- | --------- |
| A0(5)           | 0.202     | 0.308     | 0.656     | 0.905     | 0.223     | 3.791     |
| A0(10)          | 0.220     | 0.308     | 0.712     | 0.896     | 0.245     | 4.198     |
| A0(20)          | 0.221     | 0.308     | 0.716     | 0.896     | 0.246     | 4.291     |
| A0(50)          | 0.225     | 0.307     | 0.733     | 0.894     | 0.252     | 4.389     |
| A0(inf）        | **0.245** | **0.305** | **0.803** | **0.885** | **0.277** | **4.998** |

softmax
![AO_sw_2](../img/A0_sw_2.jpg)
| sm(window size) | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)   | CR(+)     | DDR(+)    |
| --------------- | --------- | --------- | --------- | -------- | --------- | --------- |
| A0(5)           | 0.110     | 0.336     | 0.330     | 3.723    | 0.030     | 1.886     |
| A0(10)          | 0.077     | 0.354     | 0.218     | 6.355    | 0.012     | 1.235     |
| A0(20)          | **0.169** | 0.335     | 0.504     | 25.424   | 0.007     | **3.199** |
| A0(50)          | 0.124     | **0.314** | 0.396     | 5.738    | 0.022     | 2.178     |
| A0(inf）        | 0.163     | 0.317     | **0.514** | **4.95** | **0.033** | 3.048     |

### 分析

* 在相对较小的训练集下，训练数据的后50个月的等权投资组合表现不如softmax，与之前实验中最大化训练数据的结果一致。排除训练数据时间长短对投资组合比较优势的影响。
* 从ASR和CR角度来看，等权情况下，训练数据时间越长，模型效果越好；而用softmax构建的投资组合受更多随机因素影响，但在最大训练数据下依然表现出最佳的性能。



## A1_m 选取股票百分比

### 目的

研究选取的股票数目对投资回报率的影响

### 结果

等权情况
![A1_m_1](../img/A1_m_1.jpg)

| ew(m)   | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| ------- | --------- | --------- | --------- | --------- | --------- | --------- |
| A1(10%) | 0.231     | 0.311     | 0.743     | 0.905     | 0.255     | 4.481     |
| A1(15%) | 0.233     | 0.309     | 0.755     | 0.895     | 0.261     | 4.591     |
| A1(20%) | **0.245** | **0.305** | **0.803** | **0.885** | **0.277** | **4.998** |
| A1(25%) | 0.224     | 0.306     | 0.734     | 0.889     | 0.252     | 4.389     |

softmax情况下

![A1_m_2](../img/A1_m_2.jpg)

| sm(m)    | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| -------- | --------- | --------- | --------- | --------- | --------- | --------- |
| A1(10%)  | 0.136     | 0.336     | 0.405     | 16.946    | 0.008     | 2.134     |
| A1(15%)  | 0.136     | 0.353     | 0.384     | 7.779     | 0.0174    | 2.229     |
| A1(20%） | **0.163** | 0.317     | **0.514** | 4.95      | **0.033** | **3.048** |
| A1(25%)  | 0.136     | **0.312** | 0.434     | **4.125** | **0.033** | 2.454     |

### 分析

* 等权情况下，选取20%的股票在所有指标上最佳。
* sigmoid权重下，选取20%的股票做投资组合在ASR和CR指标上表现最佳



## A2 更改优化目标

### 目的

原先采用IC作为优化目标，现考虑sharpe ratio和return。

### 数据集

构造50月数据集，从2016年11月到2020年12月，以加快实验速度。(以后都跑5次对收益取平均)

### 结果

等权情况

| ew(优化指标) | APR(+)     | AVOL(-)   | ASR(+)     | MDD(-)    | CR(+)       | DDR(+)     |
| ------------ | ---------- | --------- | ---------- | --------- | ----------- | ---------- |
| A2(sharpe)   | -0.019     | 0.173     | -0.108     | **4.954** | -0.003      | -0.589     |
| A2(return)   | **-0.005** | 0.169     | **-0.030** | 26.545    | **-0.0002** | **-0.167** |
| A2(IC）      | -0.025     | **0.164** | -0.155     | 1458.65   | -1.74       | -0.821     |

sigmoid情况

| sigmoid(优化指标) | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| ----------------- | --------- | --------- | --------- | --------- | --------- | --------- |
| A2(sharpe)        | 0.210     | 0.229     | 0.915     | 120.395   | 0.002     | 6.398     |
| A2(return)        | **0.232** | 0.206     | **1.131** | **0.707** | **0.329** | **8.415** |
| A2(IC）           | 0.177     | **0.199** | 0.888     | 0.714     | 0.247     | 6.295     |

### 分析

1. 关于returns优化指标表现较好可以做如下解释：由于优化目标是前m支股票的收益，相比于的IC整体排名优化，更关注前m支股票的选取情况。
2. sharpe指标表现次好的解释：sharpe具有returns指标的优点，但AVOL主要是股票总体走势的不稳定性造成的，不能很好衡量投资组合的稳定性，故不如returns. 但还是优于IC。或许可以考虑以投资组合和指数股票对冲的sharpe作为优化目标

### 完整数据集实验结果

等权
![A2_1](../img/A2_1.jpg)


| ew(优化指标)     | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| ---------------- | --------- | --------- | --------- | --------- | --------- | --------- |
| A2(sharpe_zz500) | 0.224     | 0.304     | 0.736     | 0.894     | 0.251     | 4.415     |
| A2(sharpe)       | 0.230     | **0.300** | **0.766** | 0.892     | 0.258     | **4.658** |
| A2(return)       | **0.233** | 0.309     | 0.756     | **0.890** | **0.262** | 4.543     |
| A2(IC）          | 0.225     | 0.305     | 0.735     | 0.894     | 0.251     | 4.434     |

sigmoid情况
![A2_2](../img/A2_2.jpg)

| sigmoid(优化指标) | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| ----------------- | --------- | --------- | --------- | --------- | --------- | --------- |
| A2(sharpe_zz500)  | 0.129     | 0.302     | 0.427     | **5.289** | **0.024** | 2.444     |
| A2(sharpe)        | 0.143     | **0.282** | **0.506** | 7.008     | 0.020     | **2.993** |
| A2(return)        | **0.152** | 0.306     | 0.498     | 66.626    | 0.002     | 2.885     |
| A2(IC）           | 0.141     | 0.302     | 0.466     | 7.256     | 0.019     | 2.826     |

### 分析

1. 实验结果表明，return指标为优化目标能最大化APR，sharpe指标能最大化ASR。

## A3 滑动窗口与return的组合

### 动机

由于优化指标的returns与IC不同，会对训练数据中的某些时间段更为偏重。若测试数据不具备此偏向性的特征，则投资组合不能很好地被学习，因此用滑动窗口做测试。

### 数据集

构造50月数据集，从2016年11月到2020年12月，以加快实验速度。

### 结果

等权情况

| ew(优化指标，窗口大小) | APR(+)     | AVOL(-)   | ASR(+)     | MDD(-)    | CR(+)       | DDR(+)     |
| ---------------------- | ---------- | --------- | ---------- | --------- | ----------- | ---------- |
| A3(return,5)           | -0.025     | 0.197     | -0.127     | 10.183    | -0.002      | -0.693     |
| A3(return,10)          | -0.031     | **0.171** | -0.178     | 21.272    | -0.001      | -0.894     |
| A3(return,infty)       | -0.037     | **0.171** | -0.220     | **2.940** | -0.013      | -1.173     |
| A3(IC,infty）          | **-0.009** | 0.172     | **-0.053** | 35.614    | **-0.0003** | **-0.288** |

sigmoid情况

| sigmoid(优化指标，窗口大小) | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| --------------------------- | --------- | --------- | --------- | --------- | --------- | --------- |
| A3(return,5)                | 0.255     | 0.271     | 0.940     | 0.827     | 0.308     | 6.475     |
| A3(return,10)               | 0.119     | 0.246     | 0.484     | 0.766     | 0.155     | 2.756     |
| A3(return,infty)            | 0.253     | 0.240     | 1.056     | 0.967     | 0.262     | 6.968     |
| A3(IC,infty）               | **0.270** | **0.213** | **1.270** | **0.639** | **0.423** | **9.395** |

### 分析

1. 结果表明，当用return做优化指标时，窗口较小时的结果确实会优于最大化训练窗口的情况，但由于训练数据过少，总体效果不如以IC为优化指标，最大化训练数据要好。

### 完整数据集上的结果

等权情况

| ew(窗口大小) | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| ------------ | --------- | --------- | --------- | --------- | --------- | --------- |
| A3(5)        | 0.191     | 0.313     | 0.611     | 0.910     | 0.210     | 3.515     |
| A3(10)       | 0.227     | 0.312     | 0.727     | 0.893     | 0.254     | 4.322     |
| A3(20)       | 0.222     | 0.308     | 0.722     | 0.895     | 0.248     | 4.351     |
| A3(30)       | 0.219     | **0.307** | 0.714     | 0.896     | 0.245     | 4.247     |
| A3(infty)    | **0.233** | 0.309     | **0.756** | **0.890** | **0.262** | **4.543** |
|              |           |           |           |           |           |           |
|              |           |           |           |           |           |           |

sigmoid情况

| sigmoid(窗口大小) | APR(+)    | AVOL(-)   | ASR(+)    | MDD(-)    | CR(+)     | DDR(+)    |
| ----------------- | --------- | --------- | --------- | --------- | --------- | --------- |
| A3(5)             | 0.119     | 0.296     | 0.403     | **5.959** | 0.020     | 2.214     |
| A3(10)            | 0.131     | 0.308     | 0.426     | 6.982     | 0.019     | 2.349     |
| A3(20)            | **0.160** | **0.293** | **0.546** | 7.594     | 0.021     | **3.256** |
| A3(30)            | 0.150     | 0.296     | 0.508     | 6.593     | **0.023** | 2.845     |
| A3(infty)         | 0.152     | 0.306     | 0.498     | 66.626    | 0.002     | 2.885     |
|                   |           |           |           |           |           |           |



