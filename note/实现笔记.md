# SigDE实现笔记

## 维度记号说明

| 记号 | 代表维度              |
| ---- | --------------------- |
| I    | 股票数量              |
| D    | 股票特征数量          |
| T    | 时间片数量            |
| P    | SigDE算法中的种群数量 |
| G    | 迭代次数              |



## 数据处理部分

将模型的输入数据转化为SigDE算法需要的数据形式。

### 输入数据形式

* features：候选特征数据，长度为$T$的数组，元素具有维度$(I,D)$
* indicators: 指示候选特征数值越大越好/越小越好，维度$D$
* returns: 候选股票回报率数据，长度为$T$的数组，元素具有维度$(I)$，对应feature中的下一个时刻的回报率
### 输出数据形式

* Y_data：经过Z-score归一化后的feature，长度为$T$的数组，元素具有维度$(I,D)$
* returns：候选股票回报率数据，长度为$T$的数组，元素具有维度$(I)$，对应feature中的下一个时刻的回报率
* rank_data：根据returns数据计算的股票在时间片内的真实回报率排名，长度为$T$的数组，元素具有维度$(I)$
* 注意此处returns的时间维度落后Y_data一个时间片，returns是Y_data对应的下一个时间片的测试数据。




## SigDE算法部分

SigDE类用来用来完成Sigmoid差分进化算法

### 输入（初始化）

* config：包含模型可调整参数的json对象
* Y：经过Z-score归一化后的feature，长度为$T$的数组，元素具有维度$(I,D)$
* r：股票在一个时间片内的真实回报率排名，长度为$T$的数组，元素具有维度$(I)$

### 输出

* feat_param：算法得到的最佳特征选择和特征系数的组合，具有维度(2*D)前D个数据为离散变量$\in \{0,1\}$，后D个数据为连续变量

### 参数配置

| 参数名称          | 含义                   | 默认值  |
| ----------------- | ---------------------- | ------- |
| P                 | 种群数量               | 30      |
| Cr                | 杂交率$\in(0,1)$       | 0.5     |
| beta              | 变异阶段的缩放因子     | 0.6     |
| G                 | 迭代次数               | 50      |
| tol               | 终止因子（暂未实现）   | 0.00001 |
| m_rate            | 所选股票占总股票的比重 | 0.2     |
| min_train_periods | 最小训练时间片         | 2       |

### 调用关系

self.run()

* self.x_initialization()
* loop:
  * self.mutation()
  * self.crossover()
  * self.selection()

